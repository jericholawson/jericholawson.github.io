<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Package (500 pts) - Instructions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="packageInstructions_files/libs/clipboard/clipboard.min.js"></script>
<script src="packageInstructions_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="packageInstructions_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="packageInstructions_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="packageInstructions_files/libs/quarto-html/popper.min.js"></script>
<script src="packageInstructions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="packageInstructions_files/libs/quarto-html/anchor.min.js"></script>
<link href="packageInstructions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="packageInstructions_files/libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="packageInstructions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="packageInstructions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="packageInstructions_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TLDR</a></li>
  <li><a href="#overview-and-learning-objectives" id="toc-overview-and-learning-objectives" class="nav-link" data-scroll-target="#overview-and-learning-objectives">Overview and Learning Objectives</a></li>
  <li><a href="#guidelines" id="toc-guidelines" class="nav-link" data-scroll-target="#guidelines">Guidelines</a>
  <ul class="collapse">
  <li><a href="#form-your-group-and-determine-topic." id="toc-form-your-group-and-determine-topic." class="nav-link" data-scroll-target="#form-your-group-and-determine-topic.">1. Form your group and determine topic.</a></li>
  <li><a href="#develop-a-proposal-and-help-file." id="toc-develop-a-proposal-and-help-file." class="nav-link" data-scroll-target="#develop-a-proposal-and-help-file.">2. Develop a proposal and help file.</a></li>
  <li><a href="#build-package-and-its-components." id="toc-build-package-and-its-components." class="nav-link" data-scroll-target="#build-package-and-its-components.">3. Build package and its components.</a></li>
  <li><a href="#complete-checkpoints." id="toc-complete-checkpoints." class="nav-link" data-scroll-target="#complete-checkpoints.">4. Complete checkpoints.</a></li>
  <li><a href="#create-demonstration-for-package-use." id="toc-create-demonstration-for-package-use." class="nav-link" data-scroll-target="#create-demonstration-for-package-use.">5. Create demonstration for package use.</a></li>
  <li><a href="#complete-package-development." id="toc-complete-package-development." class="nav-link" data-scroll-target="#complete-package-development.">6. Complete package development.</a></li>
  </ul></li>
  <li><a href="#components" id="toc-components" class="nav-link" data-scroll-target="#components">Components</a>
  <ul class="collapse">
  <li><a href="#proposal-and-help-file" id="toc-proposal-and-help-file" class="nav-link" data-scroll-target="#proposal-and-help-file">Proposal and Help File</a></li>
  <li><a href="#checkpoint-1-minimum-viable-project" id="toc-checkpoint-1-minimum-viable-project" class="nav-link" data-scroll-target="#checkpoint-1-minimum-viable-project">Checkpoint #1: Minimum Viable Project</a></li>
  <li><a href="#checkpoint-2-more-complete-viable-project" id="toc-checkpoint-2-more-complete-viable-project" class="nav-link" data-scroll-target="#checkpoint-2-more-complete-viable-project">Checkpoint #2: More Complete Viable Project</a></li>
  <li><a href="#demonstration" id="toc-demonstration" class="nav-link" data-scroll-target="#demonstration">Demonstration</a></li>
  <li><a href="#final-package" id="toc-final-package" class="nav-link" data-scroll-target="#final-package">Final Package</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Package (500 pts) - Instructions</h1>
<p class="subtitle lead">SDS 270: Programming for Data Science in R</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>You will be working in groups of 2-3 to create a sound, reproducible, and complete R package on a topic of your choice. Following elements:</p>
<ul>
<li>Proposal and help file (25 pts, due Thursday, 10/30 at 11:59pm)
<ul>
<li>Proposal on topic in mind, with basic functionality of package. Help file will describe an example function from proposed package.</li>
</ul></li>
<li>Checkpoint #1: Minimum Viable Project (25 pts, due Thursday, 11/20 at 11:59pm)
<ul>
<li>Own repository set up with one commit from each member in group</li>
<li>Basic layout is configured, with some attempt at each part</li>
<li>Pass R CMD check (no errors, no warnings, minimal notes)</li>
</ul></li>
<li>Checkpoint #2: More Complete Viable Project (25 pts, due Thursday, 12/4 at 11:59pm)</li>
<li>Demonstration (75 pts, given on Thursday, 12/11 during lecture)
<ul>
<li>5-7 minute demo walking through package</li>
</ul></li>
<li>Final package (350 pts, due Tuesday, 12/16 at 11:59pm)</li>
</ul>
<p>The repository will have the following elements by the last turn-in:</p>
<ul>
<li>README.md (at least 3 paragraphs about use, installation, and brief details)</li>
<li>DESCRIPTION.md (basics to package)</li>
<li>LICENSE (license for package)</li>
<li>NAMESPACE</li>
<li>R/
<ul>
<li>At least 10 function files</li>
</ul></li>
<li>tests/
<ul>
<li>At least 4 tests</li>
</ul></li>
<li>manuals/
<ul>
<li>Created for all function files</li>
</ul></li>
<li>vignettes/
<ul>
<li>At least 2 vignettes</li>
</ul></li>
<li>data/
<ul>
<li>At least one real/simulated dataset</li>
</ul></li>
</ul>
</section>
<section id="overview-and-learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="overview-and-learning-objectives">Overview and Learning Objectives</h2>
<p>As the main summative assessment of this course, you will work in groups of 2-3 to develop and create an R package that is reproducible, clear, robust, and readable. By the end of this assignment, you should be able to:</p>
<ul>
<li>Create readable and clear files for each component of an R package, including R scripts, data, tests, manuals, and vignettes</li>
<li>Work in a collaborative environment using git and GitHub</li>
<li>Demonstrate a package and how it runs to a general audience</li>
</ul>
<p>You will receive feedback on the functionality, clarity, robustness, and readability of your code and documentation through a series of checkpoints. More on that in the Components section.</p>
</section>
<section id="guidelines" class="level2">
<h2 class="anchored" data-anchor-id="guidelines">Guidelines</h2>
<section id="form-your-group-and-determine-topic." class="level3">
<h3 class="anchored" data-anchor-id="form-your-group-and-determine-topic.">1. Form your group and determine topic.</h3>
<p>You will form groups of 2-3 to work with for the project. From there, yâ€™all will determine a topic and potential functions to center a package around.</p>
<p>The package can relate to a fun or academic interest, some statistical or analytical tool, or build upon an existing package or topic as examples. Consult with me if you need guidance on the topic. In previous iterations of this course, the following topics have been explored:</p>
<ul>
<li>Analyzing bike shop operations with given data</li>
<li>Exploring Olympic data</li>
<li>Working with Federal Election Commission data</li>
<li>Expansion of the Pokedex for Pokemon</li>
</ul>
<p>You can also consider some of the packages seen in <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">CRAN itself</a>.</p>
</section>
<section id="develop-a-proposal-and-help-file." class="level3">
<h3 class="anchored" data-anchor-id="develop-a-proposal-and-help-file.">2. Develop a proposal and help file.</h3>
<p>With a topic in-hand, your group will write up a proposal that discusses the topic of your package, its potential functionality and tasks, and what the goal of the package is. Additionally, you will create a help file for an example of a function that you intend to create for the package.</p>
<p>Your proposal should be be about 2 paragraphs, while the help file should contain enough details to explain the function that you are making. This help file can and should be created through <code>Roxygen</code>.</p>
<p>Refer to the criteria in the Components section for more details on this proposal.</p>
</section>
<section id="build-package-and-its-components." class="level3">
<h3 class="anchored" data-anchor-id="build-package-and-its-components.">3. Build package and its components.</h3>
<p>In conjunction with guideline #2, you will build a base package and its components. Exercises from lectures #3 and #7 will guide you through that process, as well as the <a href="https://r-pkgs.org/">R Packages</a> textbook.</p>
<p>Note that this R package repository must exist in GitHub and be shared/cloned with everyone in the group. You will need to have the following components by the end of the project:</p>
<ul>
<li>README.md
<ul>
<li>You will write a minimum of 3 paragraphs that talks about the use, installation, and brief details. This can take on a variety of forms, but the goal of this README.md is to provide a basic understanding of what the package does for the user and how they can use it.</li>
</ul></li>
<li>DESCRIPTION.md
<ul>
<li>This file should contain package information, including but not limited to: the title, authors, version, description, license, and dependencies.</li>
</ul></li>
<li>LICENSE
<ul>
<li>This will provide a license to your package if needed.</li>
</ul></li>
<li>NAMESPACE
<ul>
<li>Should be automatically generated using <code>Roxygen</code>.</li>
</ul></li>
<li>R/
<ul>
<li>You will need to have at least 10 function files that cover the main functionality of what you intend for the package to do. Each function file should contain appropriate Roxygen comments for help files, the function itself (or functions themselves), and some error handling. The functions themselves can be of any length, but should contain enough actions that could not be replicated by another function. For example, if your function tries to calculate the mean only.</li>
</ul></li>
<li>tests/
<ul>
<li>You will need to have four test files that test the functionality of your code.</li>
</ul></li>
<li>manuals/
<ul>
<li>These will need to be created for all function files. For the manuals, you will need to have a title, description, items, values, details, and examples.</li>
</ul></li>
<li>vignettes/
<ul>
<li>A vignette can be thought of as a tutorial for a user who wants to use multiple pieces of your package. Your group will write two vignettes to detail how to run through certain actions with your package.</li>
</ul></li>
<li>data/
<ul>
<li>You will need to have at least one simulated or real-world dataset. This should be connected to the functions you create.</li>
</ul></li>
</ul>
</section>
<section id="complete-checkpoints." class="level3">
<h3 class="anchored" data-anchor-id="complete-checkpoints.">4. Complete checkpoints.</h3>
<p>Refer to the checkpoints in the components section.</p>
</section>
<section id="create-demonstration-for-package-use." class="level3">
<h3 class="anchored" data-anchor-id="create-demonstration-for-package-use.">5. Create demonstration for package use.</h3>
<p>Your group will develop a 5-7 minute demonstration that showcases the functionality of your package. You will want to talk about the rationale behind the package, how a starter can use it, and what it can do.</p>
<p>To this end, you can use one of your vignettes as an example. The package will need to be operational on at least one of your computers, so make sure that you walk through what you will showcase prior to the demonstration.</p>
<p>For more information on the criteria, see the Components section.</p>
</section>
<section id="complete-package-development." class="level3">
<h3 class="anchored" data-anchor-id="complete-package-development.">6. Complete package development.</h3>
<p>You will share the final draft of your package with me via GitHub (<code>@jericholawson</code>) by Tuesday, 12/16 at 11:59pm.</p>
</section>
</section>
<section id="components" class="level2">
<h2 class="anchored" data-anchor-id="components">Components</h2>
<section id="proposal-and-help-file" class="level3">
<h3 class="anchored" data-anchor-id="proposal-and-help-file">Proposal and Help File</h3>
<blockquote class="blockquote">
<p>25 pts, due Thursday, 10/30 at 11:59pm</p>
</blockquote>
<p>Your group will write a proposal and help file centered around the package that will be created. The proposal should address the topic you want your package to center around, what functionality your package will have, and how it will be impactful for users. The help file should be based on a proposed function in that package, where you will have all basic components.</p>
<p>The grading criteria is below:</p>
<ul>
<li>Proposal (15 pts)
<ul>
<li>Content: Is your topic extensive enough to create functions/data for? Do you provide possible sources for certain pieces of information in your package?</li>
<li>Formatting: Is the proposal clear, yet detailed? Is it in some form of a .md file? Was this turned in on time?</li>
</ul></li>
<li>Help File (10 pts)
<ul>
<li>Content: Does it contain (at a minimum) a title, description, arguments, values, details, and examples? Is the help file clear?</li>
<li>Formatting: Is it correctly formatted using <code>Roxygen</code>?</li>
</ul></li>
</ul>
<p>Both the proposal and help file will be turned in separately via Moodle by the due date. Feedback will be given on the proposal thereafter.</p>
</section>
<section id="checkpoint-1-minimum-viable-project" class="level3">
<h3 class="anchored" data-anchor-id="checkpoint-1-minimum-viable-project">Checkpoint #1: Minimum Viable Project</h3>
<blockquote class="blockquote">
<p>25 pts, due Thursday, 11/20 at 11:59pm</p>
</blockquote>
<p>This checkpoint is designed to make sure your team is on the right track. By this point, you should have a minimum viable project (MVP) that has the following specifications:</p>
<ul>
<li>(5 pts) Own package repository is set up with one commit from each member in the team</li>
<li>(10 pts) The structure mentioned in guideline #3 exists with:
<ul>
<li>At least one file for each part</li>
<li>Noticebale progress within each part</li>
</ul></li>
<li>(10 pts) Pass R CMD check (no errors, no warnings, and minimal notes)</li>
</ul>
<p>Teams will get feedback about their progress after the submission date.</p>
</section>
<section id="checkpoint-2-more-complete-viable-project" class="level3">
<h3 class="anchored" data-anchor-id="checkpoint-2-more-complete-viable-project">Checkpoint #2: More Complete Viable Project</h3>
<blockquote class="blockquote">
<p>25 pts, due Thursday, 12/4 at 11:59pm</p>
</blockquote>
<p>Continuing the momentum from the last checkpoint, you will have new additions to your package such that the following criteria is met:</p>
<ul>
<li>(5 pts) Complete, rough drafts of your README, DESCRIPTION, LICENSE, and NAMESPACE files</li>
<li>(5 pts) At least 5 function files have been created for your R/ folder</li>
<li>(5 pts) At least one complete test file</li>
<li>(5 pts) A rough draft of a sample vignette</li>
<li>(5 pts) All data necessary to run through package</li>
</ul>
<p>Teams will get additional feedback about their progress after the submission date.</p>
</section>
<section id="demonstration" class="level3">
<h3 class="anchored" data-anchor-id="demonstration">Demonstration</h3>
<blockquote class="blockquote">
<p>75 pts, given on Thursday, 12/11 during lecture</p>
</blockquote>
<p>During the final lecture of the semester (i.e.&nbsp;Thursday, 12/11), teams will present a demonstration of their package to the class. Signups will occur the week after Thanksgiving.</p>
<p>The goal of the demonstration is to show the functionality and rationale of the package. The demonstration should take about 5-7 minutes. The following criteria will be used:</p>
<ul>
<li>Context (25 pts)
<ul>
<li>Provides the rationale behind why your package is relevant and useful</li>
<li>Showcases context in the functions that are presented</li>
<li>Discusses future directions and pitfalls of this package</li>
</ul></li>
<li>Functionality (25 pts)
<ul>
<li>Shows how 2-3 functions work, either through a given walkthrough or vignette</li>
<li>Discusses accessing the package and how it can be used in conjunction with other tools</li>
</ul></li>
<li>Presentation (25 pts)
<ul>
<li>All members provide meaningful insights in an engaging and clear fashion</li>
<li>Demonstration is organized, with minimal errors and mistakes</li>
<li>Equal participation amongst all group members</li>
</ul></li>
</ul>
</section>
<section id="final-package" class="level3">
<h3 class="anchored" data-anchor-id="final-package">Final Package</h3>
<blockquote class="blockquote">
<p>350 pts, due Tuesday, 12/16 at 11:59pm</p>
</blockquote>
<p>The final package will be completed by Tuesday, 12/16 at 11:59pm. When finished, you will share the package with me via GitHub (via <code>@jericholawson</code>).</p>
<p>The layout from guideline #3 will be used here. Specifically, the criteria will be the following:</p>
<ul>
<li>Components (70 pts)
<ul>
<li>All parts are included in the package and meet the requirements mentioned in Guideline #3.</li>
</ul></li>
<li>Functionality (70 pts)
<ul>
<li>Each part of the package works as intended, with no errors or warnings.</li>
</ul></li>
<li>Appearance (70 pts)
<ul>
<li>Code is well-commented, organized, and uses certain practices for efficiency.</li>
<li>Text documents are organized and clear to the reader.</li>
<li>File names are clear and to-the-point.</li>
</ul></li>
<li>Relevance (70 pts)
<ul>
<li>Rationale to the package is legitimate.</li>
<li>Functions correspond to the packageâ€™s intended goal and description.</li>
</ul></li>
<li>Detail (70 pts)
<ul>
<li>Appropriate amount of description that conveys what the package does.</li>
<li>A complete set of R files and vignettes that provide a basic understanding of the package.</li>
</ul></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>