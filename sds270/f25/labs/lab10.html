<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="PUT NAME HERE">

<title>Exercises from Class #10: The Dots</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab10_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab10_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="lab10_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="lab10_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="lab10_files/libs/quarto-html/popper.min.js"></script>
<script src="lab10_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab10_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab10_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab10_files/libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab10_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab10_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab10_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercises from Class #10: The Dots</h1>
<p class="subtitle lead">SDS 270</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>PUT NAME HERE </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, we will learn how to pass the dots.</p>
<p><strong>Goal:</strong> by the end of this lab, you should be able to pass the dots appropriately.</p>
</section>
<section id="the-dots" class="level2">
<h2 class="anchored" data-anchor-id="the-dots">The dots</h2>
<p>The dots (<code>...</code>) are a way of collecting an arbitrary set of arguments to a function. There are two main purposes as to why you might want to have the dots as an arguments to your function.</p>
<p>First, note that you can convert the dots into a named list within your function using the <code>list()</code> function.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>catch_the_dots <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(...)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">catch_the_dots</span>(<span class="at">whatever =</span> <span class="st">"hi"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$whatever
[1] "hi"</code></pre>
</div>
</div>
<section id="passing-the-dots" class="level3">
<h3 class="anchored" data-anchor-id="passing-the-dots">Passing the dots</h3>
<p>You might want to pass the dots to another function from within your function. This is typically useful when you want to leverage the functionality of an existing function, without having to specify all of its arguments. For example, suppose we want to add theming to a <code>ggplot</code>. One way to do that would be to extend the <code>scale_color_manual()</code> function and hard-code the official Smith colors.</p>
<p>First, note that <code>scale_color_manual()</code> takes the dots as an argument.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(ggplot2<span class="sc">::</span>scale_color_manual)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (..., values, aesthetics = "colour", breaks = waiver(), 
    na.value = "grey50") 
NULL</code></pre>
</div>
</div>
<p>Moreover, it passes the dots to <code>manual_scale()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(ggplot2<span class="sc">::</span>scale_color_manual)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    manual_scale(aesthetics, values, breaks, ..., na.value = na.value)
}</code></pre>
</div>
</div>
<p>Which in turn passes the dots to <code>discrete_scale()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(ggplot2<span class="sc">:::</span>manual_scale)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    call &lt;- call %||% current_call()
    if (is_missing(values)) {
        values &lt;- NULL
    }
    else {
        force(values)
    }
    if (is.null(limits) &amp;&amp; !is.null(names(values))) {
        force(aesthetic)
        limits &lt;- function(x) {
            x &lt;- intersect(x, c(names(values), NA)) %||% character()
            if (length(x) &lt; 1) {
                cli::cli_warn(paste0("No shared levels found between {.code names(values)} of the manual ", 
                  "scale and the data's {.field {aesthetic}} values."))
            }
            x
        }
    }
    if (is.vector(values) &amp;&amp; is.null(names(values)) &amp;&amp; !is_waiver(breaks) &amp;&amp; 
        !is.null(breaks) &amp;&amp; !is.function(breaks)) {
        if (length(breaks) &lt;= length(values)) {
            names(values) &lt;- breaks
        }
        else {
            names(values) &lt;- breaks[seq_along(values)]
        }
    }
    pal &lt;- function(n) {
        if (n &gt; length(values)) {
            cli::cli_abort("Insufficient values in manual scale. {n} needed but only {length(values)} provided.")
        }
        values
    }
    discrete_scale(aesthetic, name = name, palette = pal, breaks = breaks, 
        limits = limits, call = call, ...)
}</code></pre>
</div>
</div>
<p>Which actually does the work (Note that having 3 colons <code>:::</code> allows you to access functions in an R package that aren’t <code>@export</code>ed, i.e.&nbsp;are kept hidden from the user in the function’s roxygen2 code).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(ggplot2<span class="sc">::</span>discrete_scale)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    call &lt;- call %||% current_call()
    if (lifecycle::is_present(scale_name)) {
        deprecate_soft0("3.5.0", "discrete_scale(scale_name)")
    }
    aesthetics &lt;- standardise_aes_names(aesthetics)
    check_breaks_labels(breaks, labels, call = call)
    limits &lt;- allow_lambda(limits)
    breaks &lt;- allow_lambda(breaks)
    labels &lt;- allow_lambda(labels)
    minor_breaks &lt;- allow_lambda(minor_breaks)
    if (!is.function(limits) &amp;&amp; (length(limits) &gt; 0) &amp;&amp; !is_discrete(limits)) {
        cli::cli_warn(c("Continuous limits supplied to discrete scale.", 
            i = "Did you mean {.code limits = factor(...)} or {.fn scale_*_continuous}?"), 
            call = call)
    }
    position &lt;- arg_match0(position, c("left", "right", "top", 
        "bottom"))
    is_position &lt;- any(is_position_aes(aesthetics))
    if (is.null(breaks) &amp;&amp; !is_position) {
        guide &lt;- "none"
    }
    if (is_position &amp;&amp; identical(palette, identity)) {
        palette &lt;- seq_len
    }
    ggproto(NULL, super, call = call, aesthetics = aesthetics, 
        palette = palette, range = DiscreteRange$new(), limits = limits, 
        na.value = na.value, na.translate = na.translate, expand = expand, 
        name = name, breaks = breaks, minor_breaks = minor_breaks, 
        labels = labels, drop = drop, guide = guide, position = position)
}</code></pre>
</div>
</div>
<p>According to the <a href="https://www.smith.edu/your-campus/offices-services/communications-marketing/brand-guidelines">Smith College Visual Identity program</a>, the official Smith colors are: #002855, #F2A900.</p>
<p>Thus, we can create a <code>scale_color_smith()</code> function that leverages <code>scale_color_manual()</code> by hard-coding the official Smith color values. But in order to get this to work, we have to pass the dots so that <code>scale_color_manual()</code> can do all the work that it normally does! Otherwise, we would have to copy the source of <code>scale_color_manual()</code> – but that would be inefficient and brittle.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scale_color_smith <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    ..., </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#002855"</span>, <span class="st">"#F2A900"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We can then use our custom function. Note that since it only has two colors, it won’t work if it is mapped to a categorical variable with more than two levels.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Human"</span>, <span class="st">"Droid"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> mass, <span class="at">color =</span> species)) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_smith</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 17 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab10_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Q1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write the corresponding function <code>scale_fill_smith()</code> and test it.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PUT SOLUTION HERE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Q2
</div>
</div>
<div class="callout-body-container callout-body">
<p>(Challenge) Write a <code>scale_y_continuous_smith()</code> function that produces a gradient scale from Smith blue to Smith gold.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PUT SOLUTION HERE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="the-dots-in-generic-functions" class="level3">
<h3 class="anchored" data-anchor-id="the-dots-in-generic-functions">The dots in generic functions</h3>
<p>The other main purpose of the dots is to avoid having to specify (or even know) all the arguments that S3 methods take. For example, the <code>print()</code> function takes only the argument <code>x</code> (the thing to be printed) and the dots <code>...</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(print)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, ...) 
NULL</code></pre>
</div>
</div>
<p>However, different <code>print()</code> methods take different arguments.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(print.data.frame)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, ..., digits = NULL, quote = FALSE, right = TRUE, 
    row.names = TRUE, max = NULL) 
NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(print.factor)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, quote = FALSE, max.levels = NULL, width = getOption("width"), 
    ...) 
NULL</code></pre>
</div>
</div>
<p>Note that the <code>factor</code> method passes the dots to <code>print()</code> itself. In this case, what is being run is <code>print.default()</code>, which passes them to an internal function.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(print.factor)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    ord &lt;- is.ordered(x)
    if (length(x) == 0L) 
        cat(if (ord) 
            "ordered"
        else "factor", "()\n", sep = "")
    else {
        xx &lt;- character(length(x))
        xx[] &lt;- as.character(x)
        keepAttrs &lt;- setdiff(names(attributes(x)), c("levels", 
            "class"))
        attributes(xx)[keepAttrs] &lt;- attributes(x)[keepAttrs]
        print(xx, quote = quote, ...)
    }
    maxl &lt;- max.levels %||% TRUE
    if (maxl) {
        n &lt;- length(lev &lt;- encodeString(levels(x), quote = ifelse(quote, 
            "\"", "")))
        colsep &lt;- if (ord) 
            " &lt; "
        else " "
        T0 &lt;- "Levels: "
        if (is.logical(maxl)) 
            maxl &lt;- {
                width &lt;- width - (nchar(T0, "w") + 3L + 1L + 
                  3L)
                lenl &lt;- cumsum(nchar(lev, "w") + nchar(colsep, 
                  "w"))
                if (n &lt;= 1L || lenl[n] &lt;= width) 
                  n
                else max(1L, which.max(lenl &gt; width) - 1L)
            }
        drop &lt;- n &gt; maxl
        cat(if (drop) 
            paste(format(n), ""), T0, paste(if (drop) 
            c(lev[1L:max(1, maxl - 1)], "...", if (maxl &gt; 1) lev[n])
        else lev, collapse = colsep), "\n", sep = "")
    }
    if (!isTRUE(val &lt;- .valid.factor(x))) 
        warning(val)
    invisible(x)
}</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(print.default)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, digits = NULL, quote = TRUE, na.print = NULL, print.gap = NULL, 
    right = FALSE, max = NULL, width = NULL, useSource = TRUE, 
    ...) 
NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(print.default)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    args &lt;- pairlist(digits = digits, quote = quote, na.print = na.print, 
        print.gap = print.gap, right = right, max = max, width = width, 
        useSource = useSource, ...)
    missings &lt;- c(missing(digits), missing(quote), missing(na.print), 
        missing(print.gap), missing(right), missing(max), missing(width), 
        missing(useSource))
    .Internal(print.default(x, args, missings))
}</code></pre>
</div>
</div>
<p>We will define our own <code>print()</code> method, and then run it on a <code>factor</code>. First, let’s make a <code>factor</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(starwars<span class="sc">$</span>name)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Luke Skywalker        C-3PO                 R2-D2                
 [4] Darth Vader           Leia Organa           Owen Lars            
 [7] Beru Whitesun Lars    R5-D4                 Biggs Darklighter    
[10] Obi-Wan Kenobi        Anakin Skywalker      Wilhuff Tarkin       
[13] Chewbacca             Han Solo              Greedo               
[16] Jabba Desilijic Tiure Wedge Antilles        Jek Tono Porkins     
[19] Yoda                  Palpatine             Boba Fett            
[22] IG-88                 Bossk                 Lando Calrissian     
[25] Lobot                 Ackbar                Mon Mothma           
[28] Arvel Crynyd          Wicket Systri Warrick Nien Nunb            
[31] Qui-Gon Jinn          Nute Gunray           Finis Valorum        
[34] Padmé Amidala         Jar Jar Binks         Roos Tarpals         
[37] Rugor Nass            Ric Olié              Watto                
[40] Sebulba               Quarsh Panaka         Shmi Skywalker       
[43] Darth Maul            Bib Fortuna           Ayla Secura          
[46] Ratts Tyerel          Dud Bolt              Gasgano              
[49] Ben Quadinaros        Mace Windu            Ki-Adi-Mundi         
[52] Kit Fisto             Eeth Koth             Adi Gallia           
[55] Saesee Tiin           Yarael Poof           Plo Koon             
[58] Mas Amedda            Gregar Typho          Cordé                
[61] Cliegg Lars           Poggle the Lesser     Luminara Unduli      
[64] Barriss Offee         Dormé                 Dooku                
[67] Bail Prestor Organa   Jango Fett            Zam Wesell           
[70] Dexter Jettster       Lama Su               Taun We              
[73] Jocasta Nu            R4-P17                Wat Tambor           
[76] San Hill              Shaak Ti              Grievous             
[79] Tarfful               Raymus Antilles       Sly Moore            
[82] Tion Medon            Finn                  Rey                  
[85] Poe Dameron           BB8                   Captain Phasma       
87 Levels: Ackbar Adi Gallia Anakin Skywalker Arvel Crynyd ... Zam Wesell</code></pre>
</div>
</div>
<p>Note that <code>max.levels</code> is one of the arguments to <code>print.factor()</code>, and so we can use that option. Can you spot the difference in the output? If not, read the documentation for <code>print.factor()</code> and see what the <code>max.levels</code> argument does.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(print.factor)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, quote = FALSE, max.levels = NULL, width = getOption("width"), 
    ...) 
NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x, <span class="at">max.levels =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Luke Skywalker        C-3PO                 R2-D2                
 [4] Darth Vader           Leia Organa           Owen Lars            
 [7] Beru Whitesun Lars    R5-D4                 Biggs Darklighter    
[10] Obi-Wan Kenobi        Anakin Skywalker      Wilhuff Tarkin       
[13] Chewbacca             Han Solo              Greedo               
[16] Jabba Desilijic Tiure Wedge Antilles        Jek Tono Porkins     
[19] Yoda                  Palpatine             Boba Fett            
[22] IG-88                 Bossk                 Lando Calrissian     
[25] Lobot                 Ackbar                Mon Mothma           
[28] Arvel Crynyd          Wicket Systri Warrick Nien Nunb            
[31] Qui-Gon Jinn          Nute Gunray           Finis Valorum        
[34] Padmé Amidala         Jar Jar Binks         Roos Tarpals         
[37] Rugor Nass            Ric Olié              Watto                
[40] Sebulba               Quarsh Panaka         Shmi Skywalker       
[43] Darth Maul            Bib Fortuna           Ayla Secura          
[46] Ratts Tyerel          Dud Bolt              Gasgano              
[49] Ben Quadinaros        Mace Windu            Ki-Adi-Mundi         
[52] Kit Fisto             Eeth Koth             Adi Gallia           
[55] Saesee Tiin           Yarael Poof           Plo Koon             
[58] Mas Amedda            Gregar Typho          Cordé                
[61] Cliegg Lars           Poggle the Lesser     Luminara Unduli      
[64] Barriss Offee         Dormé                 Dooku                
[67] Bail Prestor Organa   Jango Fett            Zam Wesell           
[70] Dexter Jettster       Lama Su               Taun We              
[73] Jocasta Nu            R4-P17                Wat Tambor           
[76] San Hill              Shaak Ti              Grievous             
[79] Tarfful               Raymus Antilles       Sly Moore            
[82] Tion Medon            Finn                  Rey                  
[85] Poe Dameron           BB8                   Captain Phasma       
87 Levels: Ackbar Adi Gallia ... Zam Wesell</code></pre>
</div>
</div>
<p>However, since <code>print.factor()</code> eventually passes the dots to <code>print.default()</code>, and <code>print.default()</code> accepts right as one of its arguments, we can use the right argument with the <code>print()</code> generic! Note how the text is right-justified now!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x, <span class="at">right =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]        Luke Skywalker                 C-3PO                 R2-D2
 [4]           Darth Vader           Leia Organa             Owen Lars
 [7]    Beru Whitesun Lars                 R5-D4     Biggs Darklighter
[10]        Obi-Wan Kenobi      Anakin Skywalker        Wilhuff Tarkin
[13]             Chewbacca              Han Solo                Greedo
[16] Jabba Desilijic Tiure        Wedge Antilles      Jek Tono Porkins
[19]                  Yoda             Palpatine             Boba Fett
[22]                 IG-88                 Bossk      Lando Calrissian
[25]                 Lobot                Ackbar            Mon Mothma
[28]          Arvel Crynyd Wicket Systri Warrick             Nien Nunb
[31]          Qui-Gon Jinn           Nute Gunray         Finis Valorum
[34]         Padmé Amidala         Jar Jar Binks          Roos Tarpals
[37]            Rugor Nass              Ric Olié                 Watto
[40]               Sebulba         Quarsh Panaka        Shmi Skywalker
[43]            Darth Maul           Bib Fortuna           Ayla Secura
[46]          Ratts Tyerel              Dud Bolt               Gasgano
[49]        Ben Quadinaros            Mace Windu          Ki-Adi-Mundi
[52]             Kit Fisto             Eeth Koth            Adi Gallia
[55]           Saesee Tiin           Yarael Poof              Plo Koon
[58]            Mas Amedda          Gregar Typho                 Cordé
[61]           Cliegg Lars     Poggle the Lesser       Luminara Unduli
[64]         Barriss Offee                 Dormé                 Dooku
[67]   Bail Prestor Organa            Jango Fett            Zam Wesell
[70]       Dexter Jettster               Lama Su               Taun We
[73]            Jocasta Nu                R4-P17            Wat Tambor
[76]              San Hill              Shaak Ti              Grievous
[79]               Tarfful       Raymus Antilles             Sly Moore
[82]            Tion Medon                  Finn                   Rey
[85]           Poe Dameron                   BB8        Captain Phasma
87 Levels: Ackbar Adi Gallia Anakin Skywalker Arvel Crynyd ... Zam Wesell</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Q3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Experiment by passing some other arguments accepted by <code>print.default()</code> through the dots. Do they work?</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PUT SOLUTION HERE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, we will define a new <code>print()</code> method for objects of class <code>my_factor</code>. This method displays the names of the dots, gives an affirmation of your programming, and then calls <code>NextMethod()</code>. Thus, the behavior is the same as <code>print.factor()</code>, but with a little extra information.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>print.my_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(dots) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">The dots are:"</span>, <span class="fu">names</span>(dots)))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  affirmations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"You are a really great programmer!"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"You are so good at this!"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"You're learning so much!"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Keep trying and you will get there!"</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"affirmation"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dots)) {</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">sample</span>(affirmations, <span class="dv">1</span>))</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NextMethod</span>()</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"my_factor"</span>, <span class="fu">class</span>(x))</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x, <span class="at">max.levels =</span> <span class="dv">3</span>, <span class="at">right =</span> <span class="cn">TRUE</span>, <span class="at">affirmation =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
The dots are: max.levels
The dots are: right
The dots are: affirmation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>You are a really great programmer!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]        Luke Skywalker                 C-3PO                 R2-D2
 [4]           Darth Vader           Leia Organa             Owen Lars
 [7]    Beru Whitesun Lars                 R5-D4     Biggs Darklighter
[10]        Obi-Wan Kenobi      Anakin Skywalker        Wilhuff Tarkin
[13]             Chewbacca              Han Solo                Greedo
[16] Jabba Desilijic Tiure        Wedge Antilles      Jek Tono Porkins
[19]                  Yoda             Palpatine             Boba Fett
[22]                 IG-88                 Bossk      Lando Calrissian
[25]                 Lobot                Ackbar            Mon Mothma
[28]          Arvel Crynyd Wicket Systri Warrick             Nien Nunb
[31]          Qui-Gon Jinn           Nute Gunray         Finis Valorum
[34]         Padmé Amidala         Jar Jar Binks          Roos Tarpals
[37]            Rugor Nass              Ric Olié                 Watto
[40]               Sebulba         Quarsh Panaka        Shmi Skywalker
[43]            Darth Maul           Bib Fortuna           Ayla Secura
[46]          Ratts Tyerel              Dud Bolt               Gasgano
[49]        Ben Quadinaros            Mace Windu          Ki-Adi-Mundi
[52]             Kit Fisto             Eeth Koth            Adi Gallia
[55]           Saesee Tiin           Yarael Poof              Plo Koon
[58]            Mas Amedda          Gregar Typho                 Cordé
[61]           Cliegg Lars     Poggle the Lesser       Luminara Unduli
[64]         Barriss Offee                 Dormé                 Dooku
[67]   Bail Prestor Organa            Jango Fett            Zam Wesell
[70]       Dexter Jettster               Lama Su               Taun We
[73]            Jocasta Nu                R4-P17            Wat Tambor
[76]              San Hill              Shaak Ti              Grievous
[79]               Tarfful       Raymus Antilles             Sly Moore
[82]            Tion Medon                  Finn                   Rey
[85]           Poe Dameron                   BB8        Captain Phasma
87 Levels: Ackbar Adi Gallia ... Zam Wesell</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Q4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write your own method for <code>print()</code> that works on data.frames.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PUT SOLUTION HERE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>